<!DOCTYPE html>
<html>
<head>
    <meta charset=utf-8>
    <meta name=viewport content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Login Page</title>
    <link rel=stylesheet href=/static/component/pear/css/pear.css>
    <link rel=stylesheet href=/static/admin/css/other/login.css>
</head>
<body background=/static/admin/images/background.svg style="background-size: cover;">
<form class=layui-form action=javascript:void(0);>
    <div class=layui-form-item>
        <img class=logo src=/static/admin/images/logo.png>
        <div class=title>Pear Admin</div>
        <div class=desc>明 湖 区 最 具 影 响 力 的 设 计 规 范 之 一</div>
    </div>
    <div class=layui-form-item>
        <input name="username" value="admin" placeholder="账 户 : admin" lay-verify=required hover class=layui-input>
    </div>
    <div class=layui-form-item>
        <input name="password" value="123456" placeholder="密 码 : admin" lay-verify=required hover class=layui-input>
    </div>
    <div class=layui-form-item>
        <input name="captcha_code" value="vbjfq" placeholder="验证码 :" hover lay-verify=required
               class="code layui-input layui-input-inline">
        <img src=/static/admin/images/captcha.gif class=codeImage></div>
    <div class=layui-form-item>
        <input type=checkbox title=记住密码 lay-skin=primary checked>
    </div>
    <div class=layui-form-item>
        <button type=button class="pear-btn pear-btn-success login" lay-submit lay-filter=login>登 入</button>
    </div>
</form>
<script src=/static/component/layui/layui.js></script>
<script src=/static/component/pear/pear.js></script>
<script>
  async function login(data) {
    const response = await fetch('/api/private/v1/login', {
      method: 'post',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(data),
    });
    return await response.json();
  }

  layui.use(['form', 'button', 'popup'], function() {
    var form = layui.form;
    var button = layui.button;
    var popup = layui.popup;

    // 登 录 提 交
    form.on('submit(login)', async function(form) {
      /// 验证 do something

      /// 登录 do something
      const res_data = await login(form.field);

      if (res_data.meta.status === 'success') {
        localStorage.setItem('jwt', res_data.result.access_token);
        /// 动画
        button.load({
          elem: '.login',
          time: 1500,
          done: function() {
            popup.success('登录成功', function() {
              location.href = '/';
            });
          },
        });
      } else {
        layui.layer.msg(res_data.meta.message);
      }
      return false;
    });
  });
</script>
</body>
</html>