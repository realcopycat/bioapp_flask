/** pear-admin-v3.10.0 MIT License By http://www.pearadmin.com/ */
 ;"use strict";layui.define(["layer","table"],(function(e){var t=layui.jquery,a=layui.layer,i=layui.table,r=[],n={render:function(e){e.method=e.method?e.method:"GET",n.checkParam(e)&&(e.data?n.init(e,e.data):"post"===e.method||"POST"===e.method?t.post(e.url,e.where,(function(t){e.parseData&&(t=e.parseData(t),e.data=t.data),n.init(e,t.data)})):t.get(e.url,e.where,(function(t){e.parseData&&(t=e.parseData(t),e.data=t.data),n.init(e,t.data)})))},init:function(e,a){for(var l=[],o=e.done,d=a,s=0;s<d.length;s++){var c=d[s];c.id||(c.id=c[e.treeIdName]),c.pid||(c.pid=c[e.treePidName])}!function e(t,a){for(var i=0;i<a.length;i++)if(a[i].pid==t){var r=l.length;r>0&&l[r-1].id==t&&(l[r-1].isParent=!0),l.push(a[i]),e(a[i].id,a)}}(e.treeSpid,d),e.prevUrl=e.url,e.url=void 0,e.data=l,e.page={count:e.data.length,limit:e.data.length},e.cols[0][e.treeColIndex].templet=function(t){for(var a=t.id,i=t.pid,r=t.isParent,o=n.getEmptyNum(i,l),d="",s=0;s<o;s++)d+='<span class="treeTable-empty"></span>';return d+=r?'<i class="layui-icon layui-icon-triangle-d"></i> <i class="layui-icon layui-icon-layer"></i>':'<i class="layui-icon layui-icon-file"></i>','<span class="treeTable-icon open" lay-tid="'+a+'" lay-tpid="'+i+'" lay-ttype="'+(r?"dir":"file")+'">'+(d+="&nbsp;&nbsp;")+t[e.cols[0][e.treeColIndex].field]+"</span>"},e.done=function(a,i,r){t(e.elem).next().addClass("treeTable"),t(".treeTable .layui-table-page").css("display","none"),t(e.elem).next().attr("treeLinkage",e.treeLinkage),e.treeDefaultClose&&n.foldAll(e.elem),o&&o(a,i,r)},i.render(e),r.some((function(t){return t.key===e.elem}))||r.push({key:e.elem,value:e})},reload:function(e){r.forEach((function(a){a.key===e&&(t(e).next().remove(),a.value.data=void 0,a.value.url=a.value.prevUrl,n.render(a.value))}))},search:function(e,i){var r=t(e).next(".treeTable").find(".layui-table-body tbody tr td");if(!i)return r.css("background-color","transparent"),void a.msg("请输入关键字",{icon:5});var l=0;r.each((function(){t(this).css("background-color","transparent"),t(this).text().indexOf(i)>=0&&(t(this).css("background-color","rgba(250,230,160,0.5)"),0==l&&(t("body,html").stop(!0),t("body,html").animate({scrollTop:t(this).offset().top-150},500)),l++)})),0==l?a.msg("没有匹配结果",{icon:5}):n.expandAll(e)},getEmptyNum:function(e,t){var a,i=0;if(!e)return i;for(var r=0;r<t.length;r++)if(e==t[r].id){i+=1,a=t[r].pid;break}return i+n.getEmptyNum(a,t)},toggleRows:function(e,a){if("file"!=e.attr("lay-ttype")){var i=e.attr("lay-tid"),r=e.hasClass("open");r?e.removeClass("open"):e.addClass("open"),e.closest("tbody").find("tr").each((function(){var e=t(this).find(".treeTable-icon"),n=e.attr("lay-tpid"),l=e.attr("lay-ttype"),o=e.hasClass("open");i==n&&(r?(t(this).hide(),"dir"==l&&o==r&&e.trigger("click")):(t(this).show(),a&&"dir"==l&&o==r&&e.trigger("click")))}))}},checkParam:function(e){return e.treeSpid||0==e.treeSpid?e.treeIdName?e.treePidName?!(!e.treeColIndex&&0!=e.treeColIndex)||(a.msg("参数treeColIndex不能为空",{icon:5}),!1):(a.msg("参数treePidName不能为空",{icon:5}),!1):(a.msg("参数treeIdName不能为空",{icon:5}),!1):(a.msg("参数treeSpid不能为空",{icon:5}),!1)},expandAll:function(e){t(e).next(".treeTable").find(".layui-table-body tbody tr").each((function(){var e=t(this).find(".treeTable-icon"),a=e.attr("lay-ttype"),i=e.hasClass("open");"dir"!=a||i||e.trigger("click")}))},foldAll:function(e){t(e).next(".treeTable").find(".layui-table-body tbody tr").each((function(){var e=t(this).find(".treeTable-icon"),a=e.attr("lay-ttype"),i=e.hasClass("open");"dir"==a&&i&&e.trigger("click")}))}};t("body").on("click",".treeTable .treeTable-icon",(function(){"true"==t(this).parents(".treeTable").attr("treeLinkage")?n.toggleRows(t(this),!0):n.toggleRows(t(this),!1)})),e("treetable",n)}));